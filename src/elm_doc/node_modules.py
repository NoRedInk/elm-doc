'''
Run npm commands. Uses yarn if present.
'''
import shutil
import subprocess

from elm_doc.decorators import capture_subprocess_error


def has_yarn():
    return shutil.which('yarn') is not None


@capture_subprocess_error
def install(*extra_args, **popen_kwargs):
    if has_yarn():
        subprocess.run(
            ('yarn', 'install') + extra_args,
            check=True,
            capture_output=True,
            **popen_kwargs)
    else:
        subprocess.run(
            ('npm', 'install') + extra_args,
            check=True,
            capture_output=True,
            **popen_kwargs)


@capture_subprocess_error
def add(*extra_args, **popen_kwargs):
    if has_yarn():
        subprocess.run(
            ('yarn', 'add') + extra_args,
            check=True,
            capture_output=True,
            **popen_kwargs)
    else:
        subprocess.run(
            ('npm', 'install') + extra_args,
            check=True,
            capture_output=True,
            **popen_kwargs)
